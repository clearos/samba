From d9eb1359d86b47f3d1ef9f20523aeabd844befc8 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?G=C3=BCnther=20Deschner?= <gd@samba.org>
Date: Fri, 14 Nov 2014 13:47:16 +0100
Subject: [PATCH 1/3] s3-proto: remove duplicate proto for
 add_string_to_array().
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Guenther

Signed-off-by: G端nther Deschner <gd@samba.org>
Reviewed-by: Andreas Schneider <asn@samba.org>
---
 source3/include/proto.h | 3 ---
 1 file changed, 3 deletions(-)

diff --git a/source3/include/proto.h b/source3/include/proto.h
index 255948f..ce23289 100644
--- a/source3/include/proto.h
+++ b/source3/include/proto.h
@@ -702,9 +702,6 @@ int ipstr_list_parse(const char *ipstr_list, struct ip_service **ip_list);
 void ipstr_list_free(char* ipstr_list);
 uint64_t STR_TO_SMB_BIG_UINT(const char *nptr, const char **entptr);
 uint64_t conv_str_size(const char * str);
-bool add_string_to_array(TALLOC_CTX *mem_ctx,
-			 const char *str, const char ***strings,
-			 int *num);
 void sprintf_append(TALLOC_CTX *mem_ctx, char **string, ssize_t *len,
 		    size_t *bufsize, const char *fmt, ...);
 int asprintf_strupper_m(char **strp, const char *fmt, ...);
-- 
1.9.3


From ee8ddb8e02f70e9d6050490d96a87e4fd2297a05 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?G=C3=BCnther=20Deschner?= <gd@samba.org>
Date: Fri, 14 Nov 2014 13:27:45 +0100
Subject: [PATCH 2/3] lib/util: use size_t for add_string_to_array().
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Guenther

Signed-off-by: G端nther Deschner <gd@samba.org>
Reviewed-by: Andreas Schneider <asn@samba.org>
---
 lib/util/samba_util.h   | 2 +-
 lib/util/util_strlist.c | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/lib/util/samba_util.h b/lib/util/samba_util.h
index 2f762ac..1c7ae79 100644
--- a/lib/util/samba_util.h
+++ b/lib/util/samba_util.h
@@ -253,7 +253,7 @@ _PUBLIC_ char *rfc1738_escape_part(TALLOC_CTX *mem_ctx, const char *url);
  * number of elements in strings. It will be updated by this function.
  */
 _PUBLIC_ bool add_string_to_array(TALLOC_CTX *mem_ctx,
-			 const char *str, const char ***strings, int *num);
+			 const char *str, const char ***strings, size_t *num);
 
 /**
   varient of strcmp() that handles NULL ptrs
diff --git a/lib/util/util_strlist.c b/lib/util/util_strlist.c
index 9dd4ab3..987fdfb 100644
--- a/lib/util/util_strlist.c
+++ b/lib/util/util_strlist.c
@@ -453,7 +453,7 @@ _PUBLIC_ const char **str_list_append_const(const char **list1,
  * number of elements in strings. It will be updated by this function.
  */
 _PUBLIC_ bool add_string_to_array(TALLOC_CTX *mem_ctx,
-			 const char *str, const char ***strings, int *num)
+			 const char *str, const char ***strings, size_t *num)
 {
 	char *dup_str = talloc_strdup(mem_ctx, str);
 
-- 
1.9.3


From a62cc2ce447870b4f4ab6ebf9c8d999af054d06f Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?G=C3=BCnther=20Deschner?= <gd@samba.org>
Date: Fri, 14 Nov 2014 14:12:26 +0100
Subject: [PATCH 3/3] samba: pass down size_t instead of int to
 add_string_to_array().
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Guenther

Signed-off-by: G端nther Deschner <gd@samba.org>
Reviewed-by: Andreas Schneider <asn@samba.org>

Autobuild-User(master): G端nther Deschner <gd@samba.org>
Autobuild-Date(master): Mon Nov 17 19:53:22 CET 2014 on sn-devel-104
---
 libcli/ldap/ldap_message.h                  |  2 +-
 libgpo/gpext/gpext.c                        |  2 +-
 source3/lib/eventlog/eventlog.c             |  2 +-
 source3/libads/ldap.c                       |  2 +-
 source3/libnet/libnet_join.c                |  4 ++--
 source3/rpc_server/lsa/srv_lsa_nt.c         |  2 +-
 source3/rpc_server/netlogon/srv_netlog_nt.c |  2 +-
 source3/rpc_server/spoolss/srv_spoolss_nt.c |  3 ++-
 source3/rpcclient/cmd_spoolss.c             |  5 +++--
 source3/winbindd/winbindd_cm.c              |  2 +-
 source4/torture/rpc/samba3rpc.c             |  4 ++--
 source4/torture/rpc/samr.c                  |  2 +-
 source4/torture/rpc/wkssvc.c                | 10 +++++-----
 13 files changed, 22 insertions(+), 20 deletions(-)

diff --git a/libcli/ldap/ldap_message.h b/libcli/ldap/ldap_message.h
index 4385fe6..2f64881 100644
--- a/libcli/ldap/ldap_message.h
+++ b/libcli/ldap/ldap_message.h
@@ -104,7 +104,7 @@ struct ldap_SearchRequest {
 	uint32_t sizelimit;
 	bool attributesonly;
 	struct ldb_parse_tree *tree;
-	int num_attributes;
+	size_t num_attributes;
 	const char * const *attributes;
 };
 
diff --git a/libgpo/gpext/gpext.c b/libgpo/gpext/gpext.c
index 2afcfec..1320dad 100644
--- a/libgpo/gpext/gpext.c
+++ b/libgpo/gpext/gpext.c
@@ -524,7 +524,7 @@ static NTSTATUS gp_glob_ext_list(TALLOC_CTX *mem_ctx,
 		name[PTR_DIFF(p, dirent->d_name)] = 0;
 
 		if (!add_string_to_array(mem_ctx, name, ext_list,
-					 (int *)ext_list_len)) {
+					 ext_list_len)) {
 			closedir(dir);
 			return NT_STATUS_NO_MEMORY;
 		}
diff --git a/source3/lib/eventlog/eventlog.c b/source3/lib/eventlog/eventlog.c
index 81957b1..34752fd 100644
--- a/source3/lib/eventlog/eventlog.c
+++ b/source3/lib/eventlog/eventlog.c
@@ -586,7 +586,7 @@ bool parse_logentry( TALLOC_CTX *mem_ctx, char *line, struct eventlog_Record_tdb
 		}
 	} else if ( 0 == strncmp( start, "STR", stop - start ) ) {
 		size_t tmp_len;
-		int num_of_strings;
+		size_t num_of_strings;
 		/* skip past initial ":" */
 		stop++;
 		/* now skip any other leading whitespace */
diff --git a/source3/libads/ldap.c b/source3/libads/ldap.c
index 06b4895..b46f510 100644
--- a/source3/libads/ldap.c
+++ b/source3/libads/ldap.c
@@ -3288,7 +3288,7 @@ ADS_STATUS ads_get_joinable_ous(ADS_STRUCT *ads,
 
 		if (!add_string_to_array(mem_ctx, dn,
 					 (const char ***)ous,
-					 (int *)num_ous)) {
+					 num_ous)) {
 			TALLOC_FREE(dn);
 			ads_msgfree(ads, res);
 			return ADS_ERROR(LDAP_NO_MEMORY);
diff --git a/source3/libnet/libnet_join.c b/source3/libnet/libnet_join.c
index be953ae..7c70d35 100644
--- a/source3/libnet/libnet_join.c
+++ b/source3/libnet/libnet_join.c
@@ -423,7 +423,7 @@ static ADS_STATUS libnet_join_set_machine_spn(TALLOC_CTX *mem_ctx,
 	ok = ads_element_in_array(spn_array, num_spns, spn);
 	if (!ok) {
 		ok = add_string_to_array(spn_array, spn,
-					 &spn_array, (int *)&num_spns);
+					 &spn_array, &num_spns);
 		if (!ok) {
 			return ADS_ERROR_LDAP(LDAP_NO_MEMORY);
 		}
@@ -448,7 +448,7 @@ static ADS_STATUS libnet_join_set_machine_spn(TALLOC_CTX *mem_ctx,
 		ok = ads_element_in_array(spn_array, num_spns, spn);
 		if (!ok) {
 			ok = add_string_to_array(spn_array, spn,
-						 &spn_array, (int *)&num_spns);
+						 &spn_array, &num_spns);
 			if (!ok) {
 				return ADS_ERROR_LDAP(LDAP_NO_MEMORY);
 			}
diff --git a/source3/rpc_server/lsa/srv_lsa_nt.c b/source3/rpc_server/lsa/srv_lsa_nt.c
index 67909aa..039206b 100644
--- a/source3/rpc_server/lsa/srv_lsa_nt.c
+++ b/source3/rpc_server/lsa/srv_lsa_nt.c
@@ -3335,7 +3335,7 @@ static NTSTATUS init_lsa_right_set(TALLOC_CTX *mem_ctx,
 	uint32 i;
 	const char *privname;
 	const char **privname_array = NULL;
-	int num_priv = 0;
+	size_t num_priv = 0;
 
 	for (i=0; i<privileges->count; i++) {
 		if (privileges->set[i].luid.high) {
diff --git a/source3/rpc_server/netlogon/srv_netlog_nt.c b/source3/rpc_server/netlogon/srv_netlog_nt.c
index de30106..fdcc847 100644
--- a/source3/rpc_server/netlogon/srv_netlog_nt.c
+++ b/source3/rpc_server/netlogon/srv_netlog_nt.c
@@ -397,7 +397,7 @@ NTSTATUS _netr_NetrEnumerateTrustedDomains(struct pipes_struct *p,
 	NTSTATUS status;
 	NTSTATUS result = NT_STATUS_OK;
 	DATA_BLOB blob;
-	int num_domains = 0;
+	size_t num_domains = 0;
 	const char **trusted_domains = NULL;
 	struct lsa_DomainList domain_list;
 	struct dcerpc_binding_handle *h = NULL;
diff --git a/source3/rpc_server/spoolss/srv_spoolss_nt.c b/source3/rpc_server/spoolss/srv_spoolss_nt.c
index f6fbfda..1226ec1 100644
--- a/source3/rpc_server/spoolss/srv_spoolss_nt.c
+++ b/source3/rpc_server/spoolss/srv_spoolss_nt.c
@@ -4902,7 +4902,8 @@ static WERROR string_array_from_driver_info(TALLOC_CTX *mem_ctx,
 						  const char *arch,
 						  int version)
 {
-	int i, num_strings = 0;
+	int i;
+	size_t num_strings = 0;
 	const char **array = NULL;
 
 	if (string_array == NULL) {
diff --git a/source3/rpcclient/cmd_spoolss.c b/source3/rpcclient/cmd_spoolss.c
index fb011f8..c2b1e3d 100644
--- a/source3/rpcclient/cmd_spoolss.c
+++ b/source3/rpcclient/cmd_spoolss.c
@@ -1659,7 +1659,7 @@ static bool init_drv_info_3_members(TALLOC_CTX *mem_ctx, struct spoolss_AddDrive
                                     char *args)
 {
 	char	*str, *str2;
-	int count = 0;
+	size_t count = 0;
 	char *saveptr = NULL;
 	struct spoolss_StringArray *deps;
 	const char **file_array = NULL;
@@ -2636,7 +2636,8 @@ static WERROR cmd_spoolss_setprinterdata(struct rpc_pipe_client *cli,
 		data.binary = strhex_to_data_blob(mem_ctx, argv[4]);
 		break;
 	case REG_MULTI_SZ: {
-		int i, num_strings;
+		int i;
+		size_t num_strings;
 		const char **strings = NULL;
 
 		num_strings = 0;
diff --git a/source3/winbindd/winbindd_cm.c b/source3/winbindd/winbindd_cm.c
index 5071e02..52e3fa1 100644
--- a/source3/winbindd/winbindd_cm.c
+++ b/source3/winbindd/winbindd_cm.c
@@ -1631,7 +1631,7 @@ static bool find_new_dc(TALLOC_CTX *mem_ctx,
 	int num_dcs = 0;
 
 	const char **dcnames = NULL;
-	int num_dcnames = 0;
+	size_t num_dcnames = 0;
 
 	struct sockaddr_storage *addrs = NULL;
 	int num_addrs = 0;
diff --git a/source4/torture/rpc/samba3rpc.c b/source4/torture/rpc/samba3rpc.c
index 406eb9a..ff1a53c 100644
--- a/source4/torture/rpc/samba3rpc.c
+++ b/source4/torture/rpc/samba3rpc.c
@@ -2634,7 +2634,7 @@ static bool rap_get_servername(struct torture_context *tctx,
 static bool find_printers(struct torture_context *tctx,
 			  struct dcerpc_pipe *p,
 			  const char ***printers,
-			  int *num_printers)
+			  size_t *num_printers)
 {
 	struct srvsvc_NetShareEnum r;
 	struct srvsvc_NetShareInfoCtr info_ctr;
@@ -2771,7 +2771,7 @@ static bool torture_samba3_rpc_spoolss(struct torture_context *torture)
 	struct dcerpc_binding_handle *b;
 	struct policy_handle server_handle, printer_handle;
 	const char **printers;
-	int num_printers;
+	size_t num_printers;
 	struct spoolss_UserLevel1 userlevel1;
 	char *servername;
 
diff --git a/source4/torture/rpc/samr.c b/source4/torture/rpc/samr.c
index 7dfd183..293b672 100644
--- a/source4/torture/rpc/samr.c
+++ b/source4/torture/rpc/samr.c
@@ -7258,7 +7258,7 @@ static bool test_GroupList(struct dcerpc_binding_handle *b,
 	uint32_t returned_size;
 	union samr_DispInfo info;
 
-	int num_names = 0;
+	size_t num_names = 0;
 	const char **names = NULL;
 
 	bool builtin_domain = dom_sid_compare(domain_sid,
diff --git a/source4/torture/rpc/wkssvc.c b/source4/torture/rpc/wkssvc.c
index 5bf64af..0927200 100644
--- a/source4/torture/rpc/wkssvc.c
+++ b/source4/torture/rpc/wkssvc.c
@@ -530,7 +530,7 @@ static bool test_NetrEnumerateComputerNames_level(struct torture_context *tctx,
 						  struct dcerpc_pipe *p,
 						  uint16_t level,
 						  const char ***names,
-						  int *num_names)
+						  size_t *num_names)
 {
 	NTSTATUS status;
 	struct wkssvc_NetrEnumerateComputerNames r;
@@ -666,7 +666,7 @@ static bool test_NetrAddAlternateComputerName(struct torture_context *tctx,
 	NTSTATUS status;
 	struct wkssvc_NetrAddAlternateComputerName r;
 	const char **names = NULL;
-	int num_names = 0;
+	size_t num_names = 0;
 	int i;
 	struct dcerpc_binding_handle *b = p->binding_handle;
 
@@ -708,7 +708,7 @@ static bool test_NetrRemoveAlternateComputerName(struct torture_context *tctx,
 	NTSTATUS status;
 	struct wkssvc_NetrRemoveAlternateComputerName r;
 	const char **names = NULL;
-	int num_names = 0;
+	size_t num_names = 0;
 	int i;
 	struct dcerpc_binding_handle *b = p->binding_handle;
 
@@ -781,7 +781,7 @@ static bool test_NetrSetPrimaryComputername(struct torture_context *tctx,
 	*/
 
 	const char **names_o = NULL, **names = NULL;
-	int num_names_o = 0, num_names = 0;
+	size_t num_names_o = 0, num_names = 0;
 
 	torture_comment(tctx, "Testing NetrSetPrimaryComputername\n");
 
@@ -887,7 +887,7 @@ static bool test_NetrRenameMachineInDomain2(struct torture_context *tctx,
 					    struct dcerpc_pipe *p)
 {
 	const char **names_o = NULL, **names = NULL;
-	int num_names_o = 0, num_names = 0;
+	size_t num_names_o = 0, num_names = 0;
 
 	torture_comment(tctx, "Testing NetrRenameMachineInDomain2\n");
 
-- 
1.9.3

